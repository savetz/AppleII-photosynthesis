\ LOADBLOCK 2            < 8/13/86>140                                          \ Load this block after loading block   \ 141                                                                           [FORTH]                                   145 LOAD  \ neystem." CR CR                                                           EXIT                                                                                                                                                                                            ' EXIT CFA ' FORGET-SYS !                                                                                                                                                                                                                                                                               [FORTH]                                 140 LOAD EXIT                           CR CR                                   ." Load any additional code now." CR    ." Then load screen 140 to finish" CR   ." the s ABORT ;                                                        3 BUFFERS                               ' Q CFA ' START-SYS !                   ' Q CFA ' ABORT !                       ' Q CFA ' BRK-RETN !                    ' EXIT CFA ' LOGO !                                       183 199 THRU \ Misc stuff             \ not loaded/or in overlays             \ 200 209 THRU \ TURNKEY                \ 240 259 THRU \ Chem formula           \ 260     LOAD \ test above             \ 270 276 THRU \ EXPLODE        \ MAKE AUTO BOOT         < 5/13/86>143                                                                                                                          : Q                                       256 @ 1234 = IF <ABORT> THEN            EXEC CLS <RUN>\ LOADBLOCK              <12/30/86>141  PAGE                                    ." Loading BIOLOGY extensions" CR CR CR PATCH                                     144 LOAD  \ DISK AREA DEFS              277 LOAD  \ BRODYFONT                   150 182 THRU                                                                                                                                                                                         \ FAH                                                                                                                                                                                                                                                                                                                                                                                    MAIN                                    ' BLOGO CFA ' LOGO !                                                                                                                                                            UNPATCH 3 BUFFERS                                                                                                                                                                                                                                       oto) V1.21 "            \ [ MONTH @ ] LITERAL 0 .R 47 EMIT      \ [ DAY   @ ] LITERAL 0 .R 47 EMIT      \ [ YEAR  @ ] LITERAL .                   .M/D/Y                                  ."  (fah)" CR                         ;                               w defaults                142 LOAD  \ logo word                   146 LOAD  \ kludges                   [FORTH]                                 \ -1 SAVE-VDP +! PUT-LOADER             WRITE-LOADER                            MARK-FORGET                     \ BLOGO                  <12/29/86>142                                          [FORTH]                                 APPENDIX                                : BLOGO                                   <OPDB-LOGO>                             ." Biology (Ph                                                                                                                                                                                       \ FAH                                                                    \ DISK AREA DEFINITIONS  <12/16/86>144                                                                                  2 VSTART 140 VEND \ 138 BLOCKS AVAIL                                            \ leave first 2 blocks for a program    \ to tell user t                                                                                                                                                                                       \ FAH                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              BL M-CHAR ! 9 M-BLINK !                 0 M-ON ! 0 M-OFF !                      1 DX' ! 1 DY' ! 1 DX ! 1 DY !           15 LMARG !  13 TMARG !                  3 SUBAMT !                                                                                                                                                                                                                                                                                                                            \ NEW DEFAULTS           < 5/13/86>145  \ values set here (unless changed later)\ will be the system defaults                                                     EXEC                                    1 TO 1stVar# ( allow change to P/L )    12 P/L !                                                                                                                                                                                             ( FAH  )                                                                                                                                                                                                                                                        \ FAH                                                                    G !       RUN ;                                                                                                                                                                                                                                                                                                 VLEFT?                                                                                                                                                                                                                                  : MPRINT                                  ' EXIT CFA EXEC ' PROCESS-MSG !         MPRINT ;                                                                      : RUN                                     EXEC ' FILTER CFA ' PROCESS-MShis is a data disk                                              10   VSIZE OVERLAYS                     37 REVSIZE PICS                          5 REVSIZE MSG-PTRS                     38 REVSIZE MSG-TEXT                     48 REVSIZE OPDB                 (                        < 6/26/86>146)                                         [FORTH]                                 : MLIST                                   ' EXIT CFA EXEC ' PROCESS-MSG !         MLIST ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               rVP                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             \ PREDEFINED VARIABLES   < 5/13/86>151  [FORTH]                                                                                                                 \ update pointers for loader            LOADER VAR# @ EXEC TO 1stUserVar#       EXEC VP @ TO Use                                                                                                                                                                                                                                                                REVAR INT SUBAMT                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ea      LOADER PREVAR INT PY                    LOADER PREVAR INT CX \ command area     LOADER PREVAR INT CY                                                                                                    \ sub/super-script amount               LOADER P                                                                                                                                                                                                                                                                GIC FLAG                \ system vars                                                                   \ location of areas on screen           LOADER PREVAR INT TX \ main text area   LOADER PREVAR INT TY                    LOADER PREVAR INT PX \ prompt ar                                                                                                                                                                                                                                                                \ PREDEFINED VARIABLES   < 5/13/86>150                                          [FORTH]                                 \ temporary variables                   LOADER PREVAR INT TINT                  LOADER PREVAR CHAR TCHAR                LOADER PREVAR LO                                                                                                                                                                                                                                                                \ TABLES                 < 2/10/87>152                                                                                  \ used to hold the num of secs          \ for each run of dark reaction lab     CREATE TIMES 0 , 0 , 0 ,                                                                                                                                                                                                                       \ FAH                                                                                                                                                                                                                                                                                                                                            EXIT                                                                                                                    : INXY                                    [COMPILE] INGXY                       ; IMMEDIATE                                      T if Y pressed)          BEGIN GKEY TOUC DUP ASCII Y =            OVER ASCII N = OR NOT                  WHILE DROP REPEAT                       ASCII Y = ;                                                                                                                           1 ISMODE 1MODE                          2 ISMODE 2MODE                          3 ISMODE 3MODE                          4 ISMODE 4MODE                          5 ISMODE 5MODE                                                          \ GY/N                   < 5/13/86>155                                          [EXEC]                                                                          \ wait for Y or N while flashing cursor                                         : GY/N ( -- T/F;\ 0MODE 1MODE 2MODE 3MODE< 5/13/86>153                                          : ISMODE                                  CREATE C,                               DOES> C@ SETMODE ;                                                            0 ISMODE 0MODE                                                                                                                                                                                         \ FAH                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              [COMPILE] : ; IMMEDIATE                                                                                                                                                                                                                                                                                                                                                                                                                                                                               \ KEY:                   < 5/13/86>154                                          [FORTH]                                                                         : KEY:                                    STATE @ ABORT" NO NESTING"              [KEYWORDS]                                                                                                                                                                                           \ FAH                                                                    \ MOVE                   < 5/13/86>156                                          \ Allows you to move cursor without     \ updating LASTX or LASTY               EXCODE: \ X Y --                          CURY ! CURX ! CLEANUP                 EX;                                                                                                                                                                                                    \ FAH                                                                              0 <# # # 47 HOLD DDROP                     0 # # 47 HOLD DDROP 0 # #B #> ;                                            : G.DATE ( M D Y -- ) DATE>$ GTYPE ;    : .DATE ( M D Y -- ) DATE>$ TYPE ;                                                                                                                                                                                                                                                                                                                                                                                      : #B \ blank if all done                  DDUP OR 0=                              IF BL HOLD ELSE # THEN ;                                                      : DATE>$ ( M D Y -- ADR CNT )                           \ use: NL                               KEY: NL                                   LOADER INSCR? !EXCODE ;                                                                                                                               \ #B G.DATE .DATE G.     <10/ 4/86>159                                          [FORTH]                                 : G. ( N -- )                             0 <# #S #> GTYPE ;                                                            EXIT -----      \ NL                     < 5/13/86>157                                          \ sames as: AT LASTX , LASTY + P/L      EXCODE: \ -- ;                            LASTX @ CURX ! LASTY @ P/L @            + DUP LASTY ! CURY ! EX;                                                                                                                                                                                                                     \ FAH                                                                                                                                                                                                                                                           \ FAH                                                                                                                                                                                                                                                                                                                                              !EXCODE ;                                                                                                                                                                                                                                             UP LASTY ! CURY ! EX;                                           \ USE: NL-IND                           KEY: NL-IND                               LOADER INSCR? !EXCODE ;                                                                                                                                                       \ USE: MOVE X Y                         KEY: MOVE                                 LOADER INSCR?                           TYPES INT LOADER GET-EXPR               TYPES INT LOADER GET-EXPR     \ NL-IND                 < 5/13/86>158                                          \ same as: AT LASTX , LASTY + 10        \          LET CURX := CURX + 15        EXCODE: \ -- ;                            LASTX @ 15 + CURX !                     LASTY @ 10 + D                                                                                                                                                                                       \ FAH                                                                    \ SET-RANGE              < 5/13/86>160                                          [EXEC]                                  -1 CONSTANT MAX-GETN  ( UNSIGNED VAL )   0 CONSTANT MIN-GETN                                                            EXCODE: ( LO HI R-NUM DUP EXEC 1stVar# <          ABORT" Can't change this variable"      LOADER !EXCODE C,OPDB ;                                                                                      \ FAH                                                                              MSG-BUF SCNT @ + 1+ C@                  1 SCNT +! X;                                                                  X: ^SRC ( -- ADR )                        MSG-BUF SCNT @ + 1+ X;                                                        X: DONE?           0 TO MIN-GETN -1 TO MAX-GETN           CLEANUP EX;                                                                   \ USE: INPUT var                        KEY: INPUT                                LOADER INSCR?                           GET-VA                                                                X: !DST ( B -- )                          ^DST @ DUP C@ + 1+ C!                   1 ^DST @ +C! X;                                                               X: @SRC ( -- B )                -GETN MAX-GETN               PAD 7 GETN R> @VADDR !               ELSE                                     DUP @VTYPE TYPES STR = NOT EXEC         RUN-ERR" Wrong type in INPUT"           @VADDR DUP 1+ SWAP C@ ( MAX )           GINPUT THEN                  ( FILTER PRIMS/VARS      < 5/13/86>163) [EXEC]                                  XCREATE GARBAGE                         XVAR SCNT                               XVAR ^DST                               XVAR -CASE-                             XVAR CHANGED?   \ INPUT                  < 5/13/86>161  \ will only input INT CAR or STR        \ ARG: var# C,                          EXCODE: ( -- )                            @1ARG DUP @VTYPE                        DUP TYPES INT = SWAP CAR = OR           IF EXEC >R MIN7 C, 27 C, ( sub 8 )              ASCII 8 C, 28 C, ( sub 9 )              ASCII 9 C, 29 C, ( sub 10 )             0 , ( END OF TABLE)                                                  \ FAH                                                                                                                                                                                                                                                           \ FAH                                                                              ASCII 1 C, 21 C, ( sub 2 )              ASCII 2 C, 22 C, ( sub 3 )              ASCII 3 C, 23 C, ( sub 4 )              ASCII 4 C, 24 C, ( sub 5 )              ASCII 5 C, 25 C, ( sub 6 )              ASCII 6 C, 26 C, ( sub 7 )              ASCII         \ USE: SET-RANGE lo , hi                : SET-RANGE                               LOADER INSCR?                           TYPES INT LOADER GET-EXPR               TYPES INT LOADER GET-EXPR               !EXCODE ;                                     , ( RIGHT ARROW )         ASCII L C, 5 C, ( LEFT ARROW )          ASCII U C, 2 C, ( UP ARROW )            ASCII D C, 3 C, ( DOWN ARROW )          ASCII W C, 18 C, ( up )                 ASCII Z C, 19 C, ( down )               ASCII 0 C, 20 C, ( sub 1 )    -- )                      TO MAX-GETN                             TO MIN-GETN                           EX;                                                                                                                     [KEYWORDS]                      \ REPCHAR REP            <11/ 6/86>162  [EXEC]                                  ASCII @ XCONST REPCHAR                  \ REPCHAR followed char below will      \ be replace by item indicated          XCREATE REP                               ASCII R C, 4 C ( -- T/F )                       SCNT @ MSG-BUF C@ < NOT X;                                                                                                                           ( FAH  )                                                                 \ REPTRAN                < 5/13/86>164                                          [EXEC]                                                                          X: REPTRAN ( C -- C' )                    REP                                     BEGIN                                                                                                                                                                                                \ FAH                                                                                                                                                                                                                                                                                                                                                MSG-BUF SWAP CMOVE                    THEN ;                                                                        FORGET GARBAGE                          REVECTOR FILTER INTO PROCESS-MSG        CR ." FILTER installed" CR                      P FLAG C!                 11 * + GEMIT  EX;                                                                                                     KEY: Y/N?                                 LOADER INSCR? !EXCODE ;                                                                          DUP REPCHAR =                           IF DROP @SRC REPTRAN THEN               !DST                                   REPEAT                                  CHANGED? @ ( COPY STRING BACK? )        IF ^DST @ DUP C@ 1+           \ Y/N?                   < 5/13/86>167                                          \ spaces over and waits for Y/N         \ Prints response                       EXCODE: ( -- )                            EAT-KEYS 78 ( N )                       GSPACE GY/N DU\ FILTER                 < 5/15/86>165  [EXEC]                                  : FILTER                                  0 PAD ! PAD ^DST !                      0 SCNT ! 0 CHANGED? !                   BEGIN DONE? NOT                         WHILE @SRC                                                                            ' <GEMIT> CFA ' GEMIT !                                                                                                                                                                                                                                                                                                                                                        \ FAH                                                                               IF DROP SUBAMT @ NEGATE GY +!           ELSE DUP 19 = \ down?                    IF DROP SUBAMT @ GY +!                  ELSE <GEMIT> THEN                      THEN                                   THEN ;                                                  ELSE DROP                               THEN X;                                                                                                                                                                                                                               : <GEMIT> \ C -- ;                        DUP 20 29 WITHIN                        IF SUBAMT @ GY +!                        28 + <GEMIT>                            SUBAMT @ NEGATE GY +!                  ELSE DUP 18 = \ up?                                      DUP C@ 3 PICK OVER UC= NOT              SWAP 0= NOT AND                        WHILE 2+ REPEAT                         DUP C@                                  IF 1 CHANGED? !                           SWAP DROP 1+ C@             \ <GEMIT>                < 5/16/86>166                                          \ for chars 20-29:                      \   - lower subamt                      \   - print number (n+28)               \   - raise subamt                                                                                                                                                                                                                             \ FAH                                                                    \ WAIT                   < 5/13/86>168                                                                                  IS-EXCODE WAIT                                                                  KEY: WAIT                                 LOADER INSCR?                                                                                                                                                                                        \ FAH                                                                                ." HI FRED" CR CR <ABORT> THEN ;                                                                                                                                                                                                                              R> SETMODE R> R> GXYTAB ;                                                     : <HILIT>                                 10 ' HL-HT ! {HILIT} ;                                                                                                        ror words                                                       : BDKEY \ -- KEY                          KEY                                     DUP 6 = 49249 C@ 127 > AND              49250 C@ 127 > AND                      IF DROP TEXT KEY DROP PAGE    MODE >R                   >R      ( bar that is w wide )          0 SETMODE                               ( W ) HL-HT ( height )                  R@ 0 ^MITEMS @  ( xlocation ) 5 -       R> 2 ^MITEMS @  ( ylocation )           BAR                           \ BDKEY                  < 5/13/86>171  [FORTH]                                 \ this is my back door.                 \ Press control-f with both             \ apple keys down                       \ only used when waiting for keys       \ in the disk er\ {HILIT} <HILIT>        <10/20/86>169                                          [EXEC]                                  10 CONSTANT HL-HT                                                               : {HILIT} ( w n ; hilit item n with )     GXY@ >R >R GET                                                                                                                                                                                       \ FAH                                                                                                                                                                                                                                                           \ FAH                                                                              CLEANUP EX;                                                                   KEY: 1HILIT                               LOADER INSCR?                           TYPES INT LOADER GET-EXPR               !EXCODE ;                                                                                                                                                                                                                                                                                                                               LOADER INSCR?                           TYPES INT LOADER GET-EXPR               !EXCODE ;                                                                     EXCODE: ( W -- ; During creation only )   #MITEMS @ <HILIT>                                       TYPES INT LOADER GET-EXPR               !EXCODE ;                                                                                                                                                                                     \ HILIT 1HILIT           < 5/13/86>170                                          EXCODE: ( W -- ; when running menu )      M-ITEM# @ <HILIT>                       CLEANUP EX;                                                                   KEY: HILIT                                                                                                                                                                                             \ FAH                                                                    \ INSDISK                <12/30/86>172  [FORTH]                                 ' <DISKERR> CFA CONSTANT ^DISKERR                                                   3 CONSTANT DBLK \ PS=3 BS=0         21314 CONSTANT DID  \ PS=21328 BS=21314     1 CONSTANT D                                                                                                                                                                                       \ FAH                                                                    /\/\/                                           HEX                                     : RETRY \ -- Err ; retry last             0 0C                                    DO RLAST I + @ -2 +LOOP                 RLAST @ 6 PICK 10 * B7E9 C!             <RWTS>          WHILE SCR-BUF RUN-CODE REPEAT           RUN-ERR" Brk screen exited"           ;                                                                                                                                                                                               \ retrys last argument saved by         \ >RLAST returns error status           \                                       \ /\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\  \ \ DOES NOT GO TO DISKERR if error  /  \  \/\/\/\/\/\/\/\/\/\/\/\/\/\/\                        : MYRESET                                 MODE40 INSDISK CLS HG                   5 SETMODE DX' @ DX !                    0 34 C! ( reset text margin )           BRK-SCR @ EXEC DEP !                    BEGIN READ-SCR NOT            \ >RLAST RETRY           < 5/13/86>175  [FORTH]                                 CREATE RLAST 14 ALLOT                                                           : >RLAST \ copys to 7 args to RLAST       SP@ RLAST 14 CMOVE ;                                  \ MYRESET                < 5/13/86>173  [FORTH]                                                                         VARIABLE BRK-SCR                        \ holds the OpDB address of the         \ screen to run when reset is pressed                                                                                                                                                                                                          \ FAH                                                                    2 XYTAB ." INTO DRIVE 1, THEN"      14 14 XYTAB ." PRESS SPACE"             BEGIN BDKEY BL = UNTIL                REPEAT ;                                                             \ FAH                                                                              LOADER INSCR?                           !EXCODE <INTER> ;                                                                                                                                                                                                                                             : INSDISK \ -- insert disk with DID       BEGIN PDISK? NOT                        WHILE PAGE TEXT 7 10 XYTAB                ." INSERT SIDE " DS .                   ." OF THE DISK"                         11 1                        EXCODE: \ -- ;                            REVECTOR MYRESET INTO BRK-RETN          @2ARG BRK-SCR ! EX;                                                           ( use: BRK-SCREEN name )                KEY: BRK-SCREEN ( -- ; )        S   \ BS=1 PS=2                                                 : PDISK? \ -- T; t=means proper disk      REVECTOR NOOP INTO DISKERR              EMPTY-BUFFERS DBLK BLOCK @              DID = DISK-ERROR @ 0= AND               ^DISKERR TO DISKERR ;         \ BRK-SCREEN             < 5/13/86>174  \ use: BRK-SCREEN name                  \ vectors in MYRESET into BRK-RETN      \ when crtl-RESET is pressed            \ control will transfer to this screen                                          \ args: ADR ,    DUP DISK-ERROR ! ;                                                     DECIMAL                                                                                                        \ FAH                                                                    \ RWTS PATCH             < 5/13/86>176  [FORTH]                                                                         \ saves calling arguments so it can     \ be retried if error                                                           \ ' [RWTS] CFA '                                                                                                                                                                                       \ FAH                                                                                                                                                                                                                                                                                                                                              5 15 XYTAB                              ." OR ESC TO RETURN TO MAIN MENU"       BEGIN BDKEY DUP BL = OVER 27 = OR NOT   WHILE DROP REPEAT                       27 =                                    IF HG BRK-RETN <ABORT> THEN             PAGE ;ASTX !                    CURY ! CURX ! EX;                                                             KEY: PAREA                                LOADER INSCR? !EXCODE ;                                                                                                                 ." A DISK ERROR HAS OCCURRED"           7 8 XYTAB OUT @ 0 DO 45 EMIT LOOP       9 11 XYTAB                              ." CHECK DISK AND DRIVE"                7 13 XYTAB                              ." THEN PRESS SPACE TO RETRY" \ PAREA                  < 5/13/86>179                                          \ move cursor to prompt area (PX,PY)                                            EXCODE: \ -- ;                            PX @ PY @                               DDUP LASTY ! L\ .DERR                  < 5/13/86>177  [FORTH]                                 \ if space pressed, return              \ else execute BRK-RETN                 : .DERR ( -- ; print message )            PAGE TEXT CR 1500 50 TONE               7 7  XYTAB     DISK-OOPS INTO DISKERR CR CR   REVECTOR DISK-OOPS TO ^DISKERR CR CR    ." DISKERR REVECTORED INTO DISK-OPPS"   CR CR                                                                  \ FAH                                                                                                                                                                                                                                                           \ FAH                                                                              PAGE           \ clear text screen      OLDCSW @ DUP 65008 =                    \ 65008=adr of screen output routine    IF HG THEN     \ if not printing        54 ! ;         \ restore COUT routine                                         REVECTOR        ' [RWTS] CFA ' RWTS !                   CR CR ." RWTS PATCHED" CR CR                                                                                                                                                                                                            : DISK-OOPS                               54 @ OLDCSW !  \ output routine         BEGIN .DERR    \ tell user                    INSDISK  \ right disk?                  RETRY 0= \ until succesful        UNTIL                          RWTS ! enables         \ ' DEPTH CFA ' RWTS ! disables                                                 : [RWTS] ( <7 ARGS> -- <7 ARGS> DEPTH )   >RLAST DEPTH ;                                                                                                \ DISK-OPPS              < 5/13/86>178  \ handles disk errors                   \ does not destroy HI-RES screen        \ Will leave in text mode               \ if csw does not point to ROM          [FORTH]                                   XVAR OLDCSW                                                                                                                                                                                          \ FAH                                                                    \ TAREA                  < 5/13/86>180                                          \ move cursor to text area (TX,TY)                                              EXCODE: \ -- ;                            TX @ TY @                               DDUP LASTY ! L                                                                                                                                                                                       \ FAH                                                                               DO DUP +TINT OPICKD? 0=                  IF LEAVE THEN LOOP                     DROP X;                                                                      EXCODE: ( -- )                           ORDS 10 0 FILL EX;                                                                                                                                                                                                                                                                                             )                          TINT @ + #PK + #PK MOD TINT ! X;                                             X: OPICKD? ( -- T/F )                      ORDS TINT @ + C@ X;                                                          X: FINDNXT ( I -- ) #PK 0       ASTX !                    CURY ! CURX ! EX;                                                             KEY: CAREA                                LOADER INSCR? !EXCODE ;                                                                                       \ ORD-INIT               <12/23/86>183                                          [EXEC]                                  5 XCONSTANT #PK                         XCREATE ORDS 10 ALLOT                                                           X: +TINT ( N -- \ CAREA                  < 5/13/86>181                                          \ move cursor to text area (CX,CY)                                              EXCODE: \ -- ;                            CX @ CY @                               DDUP LASTY ! L                                                                                                                                                                                       \ FAH                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    I; 0<=I<N )                SEED @ U* SWAP DROP                     SEED @ 27517 U* 2311 0 D+               DROP SEED ! ;                                                                                                                                        ASTX !                    CURY ! CURX ! EX;                                                             KEY: TAREA                                LOADER INSCR? !EXCODE ;                                                                                       \ RANDOM                 < 6/12/86>182                                          [FORTH]                                                                         VARIABLE SEED 0 SEED !                                                          : RANDOM ( N --                                 KEY: ORD-INIT                            LOADER INSCR? !EXCODE ;                                                                                       \ FAH                                                                    \ PICK-ORD               <12/23/86>184                                          \ set TINT to item picked               EXCODE: ( N -- )                          X' #PK ! 0 TINT ! #PK 0                 DO OPICKD?                               IF 1 +TINT EL 2- @ LAST-DEP @ = ;                                                                                                                                                                                                                                                      THEN ;                                                                        : CLR-MARKS                               2 SETMODE                               280 10 0 0 BAR                          5 SETMODE ;                                   em      : ^MARK \ -- ADR ;                         MARKS 1+                                MARKS C@ 2* + ;                                                              \ T= last mark is this screen           : TMARK? ( -- )                            ^MARK8 68 1 BAR                 5 SETMODE INGXY 150 0 5 GEMIT           8 GX +! G." Back"                       0 SETMODE 13 8 148 1 BAR               ELSE INGXY 100 0 4 GEMIT                 8 GX +! G." Forward"                    0 SETMODE 13 8 98 1 BAR                                                                      CREATE MARKS                              1 ALLOT \ current count                 #MARKS 2* ALLOT \ location                                                    \ address of the current mark it\ .MARKS                 <12/17/86>187  [EXEC]                                  : .MARKS \ T -- ; T=both F=only forwrd    5 SETMODE                               IF INGXY 70 0 4 GEMIT                    8 GX +! G." Forward" ( GX @ 5 + . )     0 SETMODE 13 \ MARK PRIMS             < 6/27/86>185                                          [EXEC]                                  50 CONSTANT #MARKS                      \ 0=no ESC allowed                      \ adr=Start GOSUB-STACK ptr             VARIABLE ESCMARKC! EX;                                                                  KEY: MARK                                 LOADER INSCR? !EXCODE ;                                              \ FAH                                                                    E ;                             [EXEC] FORGET ORDS                                                                                                                                                                                                               ;                                              \ marks this screen as a branch point   EXCODE:                                   LAST-DEP @ ^MARK !                      MARKS C@ 1+ DUP #MARKS < NOT            RUN-ERR" No more MARK's"                MARKS           1 ORDS TINT @ + C!                      CLEANUP EX;                           \ USE:                                  KEY: PICK-ORD                             LOADER INSCR?                           TYPES INT LOADER GET-EXPR               !EXCODS #MARKS 0 FILL EX;                                             KEY: MARK-INIT  ( ESC not allowed)        LOADER INSCR? !EXCODE 0 C,OPDB ;                                              KEY: MARK-ESC  ( ESC not allowed)         LOADER INSCR? !EXCODE 1 C,OPDBSE LEAVE THEN             LOOP                                    BEGIN LASTY @ TINT @ P/L @ * +           CURY ! GKEY                             DUP 11 = IF -1 FINDNXT THEN             DUP 10 = IF 1 FINDNXT THEN             13 = UNTIL                    \ MARK-INIT MARK         <10/20/86>186                                          \ ARG n C, \ true means ESC allowed     EXCODE: \ clear the table                 @1ARG                                   IF GSTACK @ ELSE 0 THEN                 ESCMARK ! MARK                                                                                                                                                                                       \ FAH                                                                    \ DOMARK                 <10/20/86>188  [EXEC] 0 CONSTANT LAR?                  \ wait for <- or -> key                 \ if <- just exit                       \ if -> exit the screen immed.          EXCODE: \ -- ;                            MARKS C@ DUP 0                                                                                                                                                                                       \ FAH                                                                            : DNKEY?                                  AKEYS @ IF DNAR? ELSE RTAR? THEN ;                                            EXIT                                                                                                                                                                            KEY: GOMARK                               LOADER INSCR? !EXCODE ;                                                                                                                                               2* BAR-LENS +             DUP 1+ C@ ' HL-HT !                     C@ SWAP {HILIT} ;                                                             : UPKEY? ( c -- t/f )                     AKEYS @ IF UPAR? ELSE LFAR? THEN ;                                    C! THEN                    -1 MARKS +C!                            ^MARK @ DEP ! READ-SCR                 THEN                                    EX;                                                                                                           \ MC3 UPKEY? DNKEY?      <10/20/86>191                                          [EXEC]                                  VARIABLE AKEYS \ true is up/dn                                                  : MC3 ( -- hilight current item)          M-ITEM# @ DUP \ GOMARK                 < 7/11/86>189                                                                                  EXCODE: \ -- ;                            MARKS C@                                IF TMARK? \ top = this?                  IF -1 MARKS +S @ 2* BAR-LENS + 1+ C! EX;     KEY: BAR-HT                               LOADER INSCR?                           TYPES INT LOADER GET-EXPR               !EXCODE ;                    \ FAH                                                                    O EXIT-SCR? THEN EX;                                                    KEY: DOMARK                               LOADER INSCR? !EXCODE ;                                              \ FAH                                                                    C! EX;  KEY: BAR-LEN                              LOADER INSCR?                           TYPES INT LOADER GET-EXPR               !EXCODE ;                                                                     EXCODE: ( N -- )                          #MITEM            GSTACK POP DEP ! READ-SCR DROP          GSTACK POP EP ! EXIT                   THEN                                    DUP RTAR? OVER LFAR? LAR? AND OR NOT   WHILE DROP REPEAT                       CLR-MARKS RTAR? \ go to next screen     IF 1 T                          TYPES INT LOADER GET-EXPR               !EXCODE ;                                                                     EXCODE: ( N -- )                          #MITEMS @ 2* BAR-LENS + C!              10 #MITEMS @ 2* BAR-LENS + 1+ = NOT                     IF 1 = TMARK? AND NOT THEN              DUP .MARKS TO LAR? EAT-KEYS             BEGIN KEY                                DUP 27 = ESCMARK @ 0= NOT AND           IF \ return to caller if ESC             DROP ESCMARK @ GSTACK !     \ BAR-OFFS BAR-LEN BAR-HT<10/20/86>190  [EXEC] VARIABLE BOFFS                   CREATE BAR-LENS MAX-#MITEMS 2* ALLOT                                            EXCODE: ( N -- ) BOFFS ! EX;            KEY: BAR-OFFS                             LOADER INSCR?                                                                                                                                                                                        \ FAH                                                                    \ DO-MENU3               <10/ 5/86>192                                          \ args: flag C, if true use up/dn)      EXCODE: ( -- ; )                         @1ARG AKEYS ! EP @ NEXT-EP !            LAST-DEP @ NEXT-EP 2+ !                 BEGIN M-ITEM# @                                                                                                                                                                                       \ FAH                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            ' 4 CFA ' GKEY 10 + !                                                           \ replaces a 2 in <GBK>                                                                                                                                                                                                 \ uses up/down arrows                   KEY: DO-MENU4                             LOADER END-MENU                         !EXCODE                                 1 C,OPDB ;                    \ GINPUT PATCH           < 4/ 1/87>195                                          \ GKEY 10 + @ = ' 2 CFA                                                         [FORTH]                                 4 CONSTANT 4                                            \ DO-MENU3 DO-MENU4      <10/ 4/86>193                                          \ uses left/right arrows                KEY: DO-MENU3                             LOADER END-MENU                         !EXCODE                                 0 C,OPDB ;                                                                                                                                                                                                                                                                                                     AGAIN                                  EX;                                                                                                            \ FAH                                                                                                                                                                                                                                                                                                                                               IF 1 M-ITEM# +! THEN                    M-ITEM# @ 1- #MITEMS @ +                #MITEMS @ MOD 1+ M-ITEM# !              R> 13 =                                 IF M-ITEM# @ 6 ^MITEMS @ GO-CODE        THEN                                   THEN                             LOADER INSCR? !EXCODE ;                                                                                                                                                                                                               4 ^MITEMS @ GO-CODE      MC3 KEY MC3 MENU-KEY? ?DUP              IF SWAP DROP                             ^MKEYS 1+ @ GO-CODE                    ELSE DUP >R UPKEY?                       IF -1 M-ITEM# +! THEN                   R@ DNKEY?                    \ CLEAR-STACK            < 4/ 1/87>194                                          EXCODE: ( -- )                            GSTACK SCLEAR EX;                                                                                                     KEY: CLEAR-STACK                                                                                                                                                                                       \ FAH                                                                    \ PATCH TO DRAW          < 4/ 1/87>196  [FORTH]                                 \ sets draw to use bank 1 in ram card   \ as picture buffer (4K MAX!)                                                   \ replaces PACKBUF                      : HPACKBUF ( N -                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                \ LAST SCREEN IN LOAD    <11/ 3/86>199                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          UF CFA DUP 32152 ! 32093 !      ' HEXIT CFA DUP 32170 ! 32113 !                                                                                                                        \ FAH                                                                                                                                                                                                                                                                                                                                            ' HPACKBUF CFA ' GETPIC 6 + !           ' HEXIT CFA ' GETPIC 14 + !                                                     ' HPACKBUF CFA ' <DRAW> 10 + !          ' HEXIT CFA ' <DRAW> 28 + !                                                     ' HPACKB                                                                                                                                                                                                                                                                - )                       R1-W1 53248 ;                                                                 \ replaces EXIT in words with HPACKBUF  : HEXIT                                   R> DROP R2-W2 ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              \ FAH                                                                    \ TURNKEY NOTES          <12/30/86>200                                          EXIT ---------------------------------                                          TURNKEY draws the title screen          holt logo, prentice log, and the        directions to flEC WAIT FORTH                      12 ' PICS ! ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                "          G." Rinehart Winston "                  36 EXEC WAIT FORTH                   \ Draw the prentice logo                   0 HCOLOR 280 10 0 182 BAR               3 0 105 <DRAW> 2  95 GXYTAB             G." Produced by:    "                   48 EX                           20 129 GXYTAB                           G." the disk from the disk drive."      FINS                                 X;                                                                                                               4 0 105 <DRAW>            HG 36 EXEC WAIT FORTH                \ draw the title screen                    1 0 105 <DRAW> 2 95 GXYTAB              G." PHOTOSYNTHESIS  "                   56 EXEC WAIT FORTH 8 182 GXYTAB         G."  Copyright (c) 1987 Holt \ FWRNG                  <12/30/86>203                                          X: FWRNG                                   0 HCOLOR 280 71 0 109 BAR               20 118 GXYTAB                                G." That is not the right disk. Remove"         \ TITLE                  <12/31/86>201                                                                                  : TITLE                                 \ draw the Holt logo                       HGR PAGE TEXT 60 ' PICS !               2 22 1 <DRAW>                                                                                                                                                                                       \ FAH                                                                                                                                                                                                                                                           \ FAH                                                                               20 118 GXYTAB                                G." Remove side 1 of the Modern Biology"                                   20 129 GXYTAB                           G." disk from the disk drive."          FINS X;                                                                                      The word PDISK? in the disk error       words is used to check if the proper    disk is inserted                                                                                                                r, then press RETURN."     BEGIN KEY 13 = UNTIL                 X;                                                                              X: FINST                                   0 HCOLOR 145 10 2  96 BAR                       280 71 0 109 BAR     ip.  It then            verifies that the flip was made and     calls run to execute the program                                                Turnkey is also repsonsible for         changing the disk error words to        look for the proper disk.       \ FINST                  <12/30/86>202                                          X: FINS                                    20 149 GXYTAB                           G." Insert side 2, close the disk"      20 160 GXYTAB                           G." drive doo                                                                                                                                                                                       \ FAH                                                                    \ FLIP                   <12/30/86>204                                          : FLIP                                     FINST                                   BEGIN PDISK? NOT                        WHILE FWRNG                             REPEAT                                       ;                                                                                                                                                      \ FAH                                                                              LOOP DROP FLUSH ;                                                             : QQ                                      HGR 0 0 GXYTAB                          G." Presents" GCR GCR                 ;                                               e 2       21328 TO DID 0 TO DBLK 2 TO DS          \ now flip the disk                     FLIP                                    \ set reset to jump to the menu         ' RUN CFA ' BRK-RETN !                  \ now start running virtuso code        RUN                                                                   : !8K ( N -- )                            ?NUM 8 0                                DO DUP I + BUFFER                        8192 I 1024 * + SWAP 1024 CMOVE         UPDATE                       e right disk is in 1      INSDISK                                 \ set reset to restart from scratch     \ assumes ABORT points to TURNKEY       ' ABORT @ ' BRK-RETN !                  TITLE \ draw title                      \ set disk error words for sid\                        <12/29/86>207  EXIT                                    : @8K ( N -- )                            ?NUM 8 0                                DO DUP I + BLOCK                         8192 I 1024 * + 1024 CMOVE             LOOP DROP ;   \ TURNKEY                <12/30/86>205                                                                                  : TURNKEY                                 \ set disk error words for side 1       21314 TO DID 3 TO DBLK 1 TO DS          \ make sure th                                                                                                                                                                                       \ FAH                                                                                                                                                                                                                                                           \ FAH                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            ;                                                                                                                                                                                                                                       \ REMOVE HEADS           <12/30/86>206                                                                                  FORGET FINS                                                                                                                                                                                                                                                                                                                                                                                                                                                                             EXIT                                    : LCKEY                                   <KEY> DUP ASCII - =                     IF <KEY> 32 + THEN                    ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               \ CHEMICAL PRINTER NOTES < 5/14/86>240  EXIT _________________________________                                          The idea behind these functions is to   provide an easy way to express the      chemical formulas that results in a     very clean polis current location. If ^ is        not present it is alligned on the       first character                                                                                              \ FAH                                                                            -   Restore last saved location                                                                                                                                                                                                                         nd        a superscript.                        NOTE - you only have to end sub/super-         scripts if you have to print            more things after it                                                     ^ Causes the next letter to be centered   on the x location plus offset     o to table location n               Yno Save current y location plus offset     o to table location n                   - The above are used to label             portions of the molecule          +   Save current location                               Within an string the following          characters have special meaning:                                                > will raise for superscripts and end     a subscript.                          < will drop for subscripts and e\ CHEMICAL PRINTER RULES < 5/14/86>243  EXIT _________________________________                                          The following special operations are    also defined:                                                                   Xno Save current\ CHEMICAL PRINTER RULES < 5/14/86>241  EXIT _________________________________                                          To print a element at the current       location simply inclose it in sigle     quotes (like 'HC')                                      t with a wide bond                                                      xy are specified with letters           A=1 Z=26 a=-1 z=-26 space=0                                            \ FAH                                                                                                                                                                                                                                                           \ FAH                                                                            S connect with single bond              H connect with high energy bound          (ONLY WORK WHEN y is 0 ie straight)   T connect with a tapered bond             that starts 1 pix and wides op wide   R reverse taper wide to small           W connec                                                                                                                                                                                                                                                                he type of movement     desired and xy is the amount of x and   y displacement                                                                  The following C's are defined                                                   D connect with double bond      hed formula                                                     The plan is to implement the formula    printer by passing strings that         describe the nature of the molecule                                                                             \ CHEMICAL PRINTER RULES < 5/14/86>242  EXIT _________________________________  All movement is relative to the current location and is specified as x and y    displacements and specified as follows                                          Cxy Where C is t                                                                                                                                                                                       \ FAH                                                                    \ CONSTANTS VARIABLES    < 5/15/86>244  [EXEC]                                  \ leave first head so we have something \ to forget                             7 CONSTANT CW \ character width         8 XCONSTANT CH \ character heigth       4 XCONSTANT CC \                                                                                                                                                                                       \ FAH                                                                                                                    \ code for interpretting '              \ call with character pointing to       \ first char after ' increments         \ pointer to point to first char        \ after closing '                       X: 'DO (                                                                                                                                                                                                                                                                +! THEN 62 =                IF SSAMT NEGATE GY +! THEN             ELSE GETMODE 4 SETMODE                    SWAP GEMIT SETMODE                    THEN                                   REPEAT                                  @CH DROP X; \ terminating '    ^STR +! -1 CLEFT +!      ELSE 0 THEN X;                                                                \ read current character don't inc      X: LOOKCH \ -- C/0; returns zero if end   CLEFT @ 0>                              IF ^STR C@ ELSE 0 THEN X;     \ PRSTR DO'              < 5/15/86>247  [EXEC]                                  X: PRSTR \ -- print string                BEGIN LOOKCH DUP 39 = SWAP 0= OR NOT    WHILE @CH DUP ELSPC?                     IF DUP 60 =                              IF SSAMT GY \ @CH LOOKCH             < 5/15/86>245  [EXEC]                                                                          \ read current character and inc ptr    X: @CH \ -- C/0; returns zero if end      CLEFT @ 0>                              IF ^STR C@ 1 'S ! THEN                           ELSE CWIDTH CDELX + ELLEN +! THEN      REPEAT                                  R> CLEFT ! R> TO ^STR X;                                             \ FAH                                                                     subscripts raised              5 XCONSTANT SSAMT                                                                                                                                                                                                                         LOOKCH ELSPC? NOT                       IF LOOKCH ELWID CPOS ! THEN             BEGIN LOOKCH DUP 39 = SWAP 0= OR NOT    WHILE @CH DUP ELSPC?                     IF 94 = \ new centering pos?             IF LOOKCH ELWID ELLEN @ +                CPO                                                \ holds current location                XVARIABLE MX                            XVARIABLE MY                                                                                                            \ amount center location        X: ELWID CWIDTH 2 /MOD + 1- X;          \ entered pointing to char after '      \ sets up text cursor to print the      \ element restores pointer              X: ELPOS ( -- )                           ^STR >R CLEFT @ >R 0 ELLEN !   vertical center offset                                                                                 \ pointer to current character          0 CONSTANT ^STR                         \ number of characters left in string   XVARIABLE CLEFT                 \ ELSPC? ELPOS           < 5/15/86>246  [EXEC]                                  X: ELSPC? \ C -- T/F; T if < > or ^       DUP 60 = OVER 62 = OR SWAP 94 = OR X;                                         XVARIABLE ELLEN \ len in pixs           XVARIABLE CPOS \ -- )                             ELPOS MX @ CPOS @ - MY @ CC - GXYTAB    PRSTR X;                                                                                                     \ FAH                                                                    \ MOVE DRAW PRIMS        < 5/15/86>248  [EXEC]                                  XVARIABLE MEX \ ending x value          XVARIABLE MEY \ ending y value          XVARIABLE MSX \ rise                    XVARIABLE MSY \ run                     \ given a charac                                                                                                                                                                                                                                                                          COPYEND X;                                                                    \ draw a reverse taper bond             X: RDO ( -- ) SETEND                      @MXY MEL @MEXY LINE                     @MXY @MEXY LINE                         @MXY M          COPYEND X;                                                                                                            \ just moves                            X: MDO                                    SETEND COPYEND X;                                                                                             \ draw a taper bond                     X: TDO ( -- ) SETEND                      @MXY @MEXY MEL LINE                     @MXY @MEXY LINE                         @MXY @MEXY MER LINE           Y ;                       MEX @ MEY @ X;                                                                \ draw a single bound                   X: SDO ( -- )                             SETEND                                  @MXY @MEXY LINE               \ DOD TDO RDO            < 5/15/86>251  [EXEC]                                  \ draw a double bond                    X: DOD ( -- ) SETEND                      @MXY MEL @MEXY MEL LINE                 @MXY MER @MEXY MER LINE                 COPYEND X;    \ SDO MDO @MXY @MEXY     < 5/15/86>249  [EXEC]                                                                          X: @MXY \ -- X Y ;                        MX @ MY @ X;                                                                  X: @MEXY \ -- X  X Y -- X' Y'                     >R MSY @ NSIGN SCASE NEGATE +           R> MSX @ NSIGN + X;                                                                                          \ FAH                                                                    TVAL DUP MSY ! MY @ + MEY ! X;                                          X: COPYEND \ set new point to last end    MEX @ MX ! MEY @ MY ! X;                                             \ FAH                                                                            \ Return Point to the left              X: MEL \ X Y -- X' Y'                     >R MSY @ NSIGN SCASE +                  R> MSX @ NSIGN NEGATE + X;                                                    \ Return point to the right             X: MER \          DUP ASCII a ASCII z WITHIN              IF ASCII a - 1+ NEGATE EXIT THEN        1 ABORT" Bad offset" X;                                                       X: SETEND \ enter pointing to offsets     @CH GETVAL DUP MSX ! MX @ + MEX !       @CH GEhit apple computer      X: SCASE \ N -- M                         MSX @                                   IF MSY @ ABS MSX @ ABS / 1 >            ELSE 1 THEN                             IF 2* THEN X;                                                         ter return its value    \ A to Z = 1 to 26 a to z = -1 to -26   \ space = 0                             X: GETVAL \ C -- V; aborts if error       DUP BL = IF DROP 0 EXIT THEN            DUP ASCII A ASCII Z WITHIN              IF ASCII A - 1+ EXIT THEN     \ NSIGN MEL MER          < 5/15/86>250  [EXEC]                                  X: NSIGN \ V -- -1/0/1;                   DUP                                     IF 0> 2* 1- THEN X;                                                           \ deal w/ this sER @MEXY LINE                     COPYEND X;                                                                                                                                           \ FAH                                                                    \ WDO CDO                < 5/15/86>252  [EXEC]                                  \ draw a wide bond                      X: WDO ( -- ) SETEND                      @MXY MEL @MEXY MEL LINE                 @MXY @MEXY LINE                         @MXY MER @MEXY                                                                                                                                                                                       \ FAH                                                                            X: @YI ( N -- V )                          XR IF 6 SWAP - THEN                     2* BC + 1+ C@ YR IF NEGATE THEN X;                                           \ do a corner XR YR decide orienatation X: BRC \ X Y -- X' Y';                    DDUP D                                                X: -DO                                    OPOS D@ MY ! MX ! X;                                                                                                                                                                          0 CONSTANT XR \ reverse x values        0 CONSTANT YR \ reverse y values                                                X: @XI ( N -- V )                          XR IF 6 SWAP - THEN 2* BC + C@ X;                                     MX ! X;                                                                                                XVARIABLE OPOS 2 ALLOT                                                          X: +DO                                    @MXY OPOS D! X;               \ BDO                    < 5/15/86>255                                          XCREATE BC                                0 C, 1 C, 1 C, 1 C, 0 C, 1 C,           1 C, 1 C, 1 C, 0 C, 1 C, 1 C,           1 C, 0 C,                                             \ 0DO +DO -DO            < 5/15/86>253  [EXEC]                                  \ set MX MY to current cursor position  \ clear up any other viables                                                    X: 0DO                                    GY @ MY ! GX @                                                                                                                                                                                       \ FAH                                                                                                                                                                                                                                                           \ FAH                                                                            X: YDO ( -- )                             @CH ^MXYPOS >R                          MY @ @CH GETVAL + R> 2+ ! X;                                                  X: GDO ( -- )                             @CH ^MXYPOS D@ MX ! MY ! X;                                                                                                                                                                                                                                                                                   MXYPOS + ;                                                      \ Xno - Saves MX plus offset o to n     X: XDO ( -- )                             @CH ^MXYPOS >R                          MX @ @CH GETVAL + R> ! X;                                              MER LINE                 COPYEND X;                                                                    \ set color for bounds/braces           X: CDO ( -- )                             @CH GETVAL HCOLOR X;                                                  \ XDO YDO GDO            < 5/16/86>254                                          XCREATE MXYPOS 40 ALLOT                 : ^MXYPOS \ N -- ADR;                     DUP ASCII 0 ASCII 9 WITHIN NOT          ABORT" Bad index"                       ASCII 0 - 4 * OT 7 0                            DO SWAP I @XI + SWAP I @YI +              DDUP DOT LOOP X;                                                                                           \ FAH                                                                    \ BRACE BDO              < 5/15/86>256  \ set YR to value before call           : BRACE \ LEN --                          GETMODE >R 1MODE 20 - 4 / >R            0 TO XR                                 @CURSOR BRC R@ 0                        DO >R 2+ R> DD                                  1 ABORT" BAD COMMAND"                 X;                                                                                                             \ FAH                                                                            KEY: CFORM                                LOADER INSCR?                           TYPES INT LOADER GET-EXPR               TYPES INT LOADER GET-EXPR               !EXCODE ;                                                                     [FORTH]           >R <DOCOMD>                             BEGIN DUP C@ ?DUP                       WHILE R@ =                               IF R> DROP 1+ @ 2+ >R EXIT              THEN                                    3 +                                    REPEATm --                      0                                       DO DUP >R @GMSG                           MSG-BUF DOFORM                          R> 1+                                 LOOP DROP CLEANUP EX;                                                 DO [ ASCII Y C, ] YDO [   ASCII + C, ] +DO [ ASCII - C, ] -DO [   ASCII B C, ] BDO [ ASCII G C, ] GDO [   0       C, 0 ,                                                                \ execute code for char or error        X: DOCOMD ( C -- )              \ CFORM                  < 5/15/86>259                                          \ use: CFORM mes, num                   \ will num messages starting with       \ mes from the current groupt and       \ will feed it to DOFROM                EXCODE: \ mes nu\ DOCOMD                 < 5/16/86>257  XCREATE <DOCOMD>                          ASCII 0 C, ] 0DO [ ASCII ' C, ] 'DO [   ASCII S C, ] SDO [ ASCII M C, ] MDO [   ASCII D C, ] DOD [ ASCII T C, ] TDO [   ASCII R C, ] RDO [ ASCII W C, ] WDO [   ASCII X C, ] X                                                                                                                                                                                       \ FAH                                                                     ' expected'"                     ELPOS 2/ ELLEN @ 2/ - GX +!             YR IF -20 ELSE 10 THEN GY +!            PRSTR X;                                                             \ FAH                                                                                                                                                                                                                                                                                                                                            X: BDO \ -- ;                             @CH ASCII 1 = TO YR                     @CH ^MXYPOS >R                          R@ @ R@ 2+ @ !CURSOR                    @CH ^MXYPOS @ R> @ - DUP BRACE          @CH ASCII ' = NOT                       ABORT"                                                                                                                                                                                                                                                                UP DOT LOOP               1 TO XR BRC                             YR NOT TO YR 0 TO XR BRC                R> 0 DO >R 2+ R> DDUP DOT LOOP          1 TO XR BRC DDROP                       YR NOT TO YR R> SETMODE ;                                             \ DOFORM                 < 5/15/86>258                                          : DOFORM \ ADR -- ;                       COUNT CLEFT ! TO ^STR                   BEGIN LOOKCH                            WHILE @CH DOCOMD                        REPEAT ;                                      FORGET CH \ REMOVE HEADS                                                                                                                               \ FAH                                                                    \ TEST WORDS             < 5/15/86>260  [FORTH]                                 \ test word, given adr of :$ words      \ will run them all through DOFORM                                              : DRAWMOL \ adr -- ;                      >R 1          bSIbMEb'C<2>H<5'$ \                .$ -MaESbDMaE'C'+$    \ C DDL C         .$ Me Sf Mf 'N'$      \ C SL  N         .$ MafDbc$            \                                                                                                                       C                                                .$ -MBESBDMAE'H^C'+$                     .$ MD SE MF 'C'$                        .$ MBeSBdMdH$                           .$ MBEDBDMBE'O'$                       .$ -MbESbDMbE'C'+$                       .$ Me           .$ -MEbDGbMDb'C'+$    \ C DUR C         .$ M h'H'$            \                 .$ -MEBSGBMDB'C'$     \ C SDR C         .$ MEbSDbMDb'C'+$     \ C DUR C         .$ M eS eX2 Y2 M e'R' $                 .$ -MEBDDBMDB'C'+$    \ C DDR C         .$ MElen of tail off O                                                 .$ -MDaSDbMCd'C'+$                       .$ MaeSbd$                             .$ -MFBDJBMEA'C'+$                       .$ MEbSDb$                           \  .$ MEbSDbMDb'C'+$     \ C DURH^C'$    \                 .$ MEbDDbMDb'CH'MNB'2'$ \ CH2           .$ -MEBSDBMDB'C'+$    \ C SDR C         .$ MaESbDMaE'N'$      \ C SDL N         .$ Mf Sf Me 'C'$      \ N SL  C         .$ MaeSbd$            \                                              \                        < 5/15/86>263                                             .$ Me Si M A'CH<^2'$                    .$ MrDSdBMdC'C'$                        .$ Me Dc Me 'O'$                        .$ MRBSDBMDC'O'$                        .$ MaES F$ \ \ GLUCOSE                < 5/16/86>261  FORGET GLUCOSE                          :$ GLUCOSE                                 .$ 0'H<3>^C'$         \                 .$ MEBSIBMEB'C'$      \                 .$ MEbDDbMDb'C'+$     \ C DUR C         .$ M eS eM e'BSiBMeB'H<3>^C'$   \              .$ -MCDSDBMEB'C'+$     \ C SDL C         .$ MAH'H'$                              .$ MdeSdJMcD'CH<2'$                                                                                                                                                                                                  -->                                                                                                                                                                                               .$ -MgbSdb$                             .$ -MgBSdBMfB'N'$                        .$ Mf Df Me 'C'+$                       .$ MebSdbMeb'C^H'$                      .$ MFbDDb$                             .$ -MaESbDMaE'CH'+$                      .$ Me        EXIT                                                                            : DRAWINIT                                HGR 1HG 0 20 XYTAB                      10 70 !CURSOR 3 HCOLOR                  20 MX ! 70 MY ! ;                             C'$     \ C SDL C          .$ MebDcbMeb'C'$      \ C DUL C         .$ MAeSCdMAe'N'+$     \ C SUR N         .$ MF SF $                                                                     .$ -MfbSdbMnb'Mg'+$                      .$ MNbSDb$                                             BEGIN DUP R@ N$                         WHILE EXEC DOFORM 1+                    REPEAT R> DDROP ;                     : A 261 265 THRU ;                      : GLUCOSE ;                             A                               \                        < 5/14/86>262                                            .$ -MEBDDBMDB'CH'$    \ C DDR CH         .$ MeBSdBMdB'C'$      \ C DDL C         .$ MAEDBDMAE'C'+$     \ C DDR C         .$ MEBSIBMEB'CH<3'$   \                .$ -MeBScBMeB' Dd Me 'O'$                       .$ -MBESBDMBE'O'$                        .$ ME SD ME 'CH>3'$                                                          ;$                                                                                                      \ PHYTOL                 < 5/16/86>264                                          :$ PHYTOL                                  .$ 0S TM E'H<2>^C$                      .$ MEcSDbMEc'C'+$                       .$ M eS dM e'H'X0dY0f$                 .$ -MECDDBMEC'                                CR CR                                   ." USE: SHOW clear and draw" CR CR                                              SHOW EL                                                                                                                                                                                                                                                                                                                                                                         \ 34 138 !CURSOR                        \ PHYTOL DRAWMOL                        \ 15 0 LOT 15 182 LOT                   \ 15 162 LOT 15 172 LOT                 \ 15 152 LOT                              BEGIN KEY BL = UNTIL TEXT ;                                                                                                                                                                                                                                                                                                           : SHOW                                    HGR 1 HCOLOR                            2 139 0 11 BAR  2 139 278 11 BAR        280 1 0 11 BAR  280 1 0 150 BAR         40 44 !CURSOR ATPC HCOLOR               GLUCOSE DRAWMOL                                                                                                                                                                                                                                                                               \ SHOW                   < 5/16/86>265  \ FORGET LOT                            : LOT ( X Y -- ) GXYTAB                 G." This is a line of text gmlyyyy" ;                                           3 CONSTANT ATPC                                                                                                                                                                                                                                                                                                          SE ME 'H'$                     ;$                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         .$ B101'Phytol'$ ;$                  :$ CLORO                                \ two chloropyls                           .$ G2S cM e'CH<3'$ \ A                  .$ G2S cM e'C'+$ \ B                    .$ M eD dM e'O'$                       .$ -MD                                                                                                                                                                                                                                                                C'+$                       .$ M ES DM E'CH<3'-$                    .$ MEcSDbMEc'C'+$                       .$ M i'H'MHB'2'$                       .$ -MECSDBMEC'C'+$                       .$ M I'H'MHB'2'-$                       .$ MEcSDbMEc'CH<3'+X1V$                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                CLC, BX LDA, SEC ADC, PHA,              BX 1+ LDA, SEC 1+ ADC,                  TAY, PLA, X' {BLW} JSR,                                                         XSAVE LDX,                              RTS,      XC;                                 >           2MODE DUP <BLOW> <BLOW>                 1 EP +! REPEAT                        R> SETMODE ;                                                                                                                                                          point                     XSAVE STX,                              SEC, BX LDA, SEC SBC, PHA,              BX 1+ LDA, SEC 1+ SBC,                  TAY, PLA, X' {BLW} JSR,                                                         XSAVE LDX,                    BLOW> THEN                 2MODE I IND <BLOW> EP @ 0>              IF EP @ IND <BLOW> THEN                 1 EP +!                                LOOP                                    BEGIN EP @ #STEPS <                     WHILE 1MODE EP @ IND DUP <BLOW\ {BLOW}                 < 5/16/86>271  \ draws four points at                  \ (BX-XO,BY-YO), (BX+XO,BY-YO),         \ (BX-XO,BY+YO),& (BX+XO,BY+YO)                                                 XCODE {BLOW} \ XO YO -- XO YO ;           \ set left end\ EI2                    < 5/16/86>269                                          : EI3 \ -                                 GETMODE >R -10 EP !                     #STEPS 1                                DO 1MODE I IND <BLOW> EP @ 0>            IF EP @ IND <, SEC, BOT SBC, TAX,              ' $YADDR JSR, ' $HLINEB JSR,                                                    RTS, XC;                                                             \ FAH                                                                                                                                                                                                                                                                                                                                                                                      XSAVE LDX,                              BY LDA, CLC, BOT ADC, TAX,              ' $YADDR JSR, ' $HLINEB JSR,                                                    XSAVE LDX,                              BY LDA                                                                                                                                                                                                                                                                LEFT.D7 STA,              LMASKS ,Y LDA, LEFT.MSK STA,                                                    N 2 + LDA, N 3 + LDY, \ its later       CLC, # 1  ADC, CS IF, INY, THEN,        ' $ENDPT  JSR, RIGHT.D7 STA,            RMASKS ,Y LDA, RIGHT.MSK STA,                                                                                                                                                                                                                                                                 \ BX BY {BLW}            < 5/15/86>270  VARIABLE BX \ center for explosion      VARIABLE BY                             \ .A = x coord lsb .Y=msb               XCODE {BLW} \ XO YO -- XO YO              N 2+ STA, N 3 + STY, \ save for later   ' $ENDPT JSR,                                                                                                                                                                                        \ FAH                                                                    \ XO YO #STEPS EP {>>5}  < 5/15/86>272                                          XCREATE XO \ y offsets from center        0 C, 27 C, 24 C, 24 C,                  16 C, 9 C, 4 C,                       XCREATE YO                                0 C, 6 C, 12 C                                                                                                                                                                                       \ FAH                                                                              WHILE EP @ IND DUP <BLOW> <BLOW>         1 EP +! REPEAT                         R> SETMODE ;                                                                  : EI2 \ --                                GETMODE >R 1MODE #STEPS 1               DO I I           N 1- DEC,                              0= UNTIL,                               BOT STA,                                RTS,                                  XC;                                                                                                               DO 1MODE I IND <BLOW> EP @ 0>            IF 2MODE EP @ IND <BLOW>                ELSE I IND <BLOW> THEN                  1 EP +!                                LOOP                                    BEGIN EP @ #STEPS <                                      .A ASL,                                 BOT 1+ ROL,                             N 1+ ASL,                               CS IF, CLC, N ADC,                       CS IF, BOT 1+ INC, THEN,               THEN,                        \ E/I IND EI1 EI2        < 5/15/86>275  1 CONSTANT E/I                          X: IND \ I -- I'                          E/I NOT IF #STEPS SWAP - THEN X;      : EI1 \ -                                 GETMODE >R -15 EP !                     #STEPS 1      \ {B*}                   < 5/15/86>273                                          \ Mult N by N1+ Place result at BOT     XCODE {B*} \ ?? -- [N]*[N+1]              8 # LDA, N 1- STA,                      0 # LDA, BOT STA, BOT 1+ STA,           BEGIN,        C,                                0= UNTIL,                               POP JMP, XC;                                                                                                 \ FAH                                                                                                    XC;                                                                                                                                                    \ FAH                                                                               BV 1+ LDA, N 1+ STA, ( l )              BV LDY, ( i )                           YO ,Y LDA, N STA,                       X' {B*} JSR, X' {>>5} JSR,              X' {BLOW} JSR,                          INX, INX,                               BV DE        XCODE {>>5} ( X -- X/32 )                 CLC, BOT 1+ ROR, BOT ROR,               CLC, BOT 1+ ROR, BOT ROR,               CLC, BOT 1+ ROR, BOT ROR,               CLC, BOT 1+ ROR, BOT ROR,               CLC, BOT 1+ ROR, BOT ROR,               RTS,   STA, ( l )               BEGIN,                                   BV 1+ LDA, N 1+ STA, ( l )              BV LDY, ( i )                           XO ,Y LDA, N STA,                       X' {B*} JSR, X' {>>5} JSR,              DEX, DEX,                    , 18 C,                   25 C, 28 C, 32 C,                                                             32 XCONSTANT #STEPS                     XVARIABLE EP                                                                    \ shift bot right five bits     \ <BLOW>                 < 5/15/86>274                                          XVARIABLE BV                            \ draws ray i at len l                  XCODE <BLOW> \ l -- ;                     6 # LDA, BV STA, ( i )                  BOT LDA, BV 1+ND <BLOW> LOOP                    2MODE #STEPS 1                          DO I IND <BLOW> LOOP                    R> SETMODE ;                                                         \ FAH                                                                    \ EXPLODE                < 5/15/86>276  \ use: EXPLODE type                     \ 1=Implosion type 3                    \ 2=Implosion type 4                    \ 3=Explosion type 1                    \ 4=Explosion type 2                                                                                                                                                                                                                           ( bobp ) U]U]U]www3;www3	               
   	  ??  	  	  	  		s              _		p ~c~                                                                                                                                                                                                                          EXIT                                                                                                                                                                                                            	<?   	  nscsn`> 	;gccc   	    	  	33   	   
	    O3333    _	  3333  	  333  	  ;gcg;	  nscsn``	    	  >0  	?  	  3333>  	  cc66  
	    3333N    _	  33  	  33                        BRODYFONT ' ASCTAB !                                                                                                    BLK @ 1+ BLOCK ASCTAB        1024 CMOVE BLK @ 2+ BLOCK ASCTAB 1024 +  600 CMOVE                                 O[scC    _	6ccc6  	333  	 6 c c s v \    _	3333   	303   	?   	333333   	CCf f < <      _		;oG    _	3333  	CCf <        _	?0?   	  nscsn   	;gcg;   	  33   	``nscsn   	  >c?~   ( LOAD BRODY FONT        < 3/16/86>277)                                         CR CR ." LOADING BRODY FONT " 2BEEP     CR CR 2BEEP                                                                     CREATE BRODYFONT 1624 ALLOT                                	       	     	        	     	30    	|3[[6    _	66c  	3333  	66  	33333  	  	  	6csf<  	333?333  	  	  	33  	  		Go;    _	CG                                FORGET {BLW}                                                                                                                                           \ FAH                                                                    3 s ^    _	        	   	   	 3?3    	 ?    	        	         	         	@` 0         _	33333   	   	308?   	3003   	 08<60   	?303   	833   	0   	3333   	33>   	                                                     KEY: EXPLODE                              LOADER INSCR?                           TYPES INT LOADER GET-EXPR               !EXCODE ;                                                                             8	             	UUUUUUU  		p ~c~     	?  	?  		  @ @@@      	           	    Cco0 C3 6 _c       	         o	   o	       o		l l l l l     _	 ~ [ x [~    _
	[n 0 XlF    _	 6 <                          EXCODE: \ T --                            GXY@  BY ! BX !                         DUP 2 > TO E/I                          1 AND IF EI1 ELSE EI2 THEN              CLEANUP                               EX;                               % 1 = R g                                                           	!-9EQ]r~&2GS_kw.:FR^s            	!-9EZfr~#                                                                                                                                                                                                                                          	!	RGCUQQ6D